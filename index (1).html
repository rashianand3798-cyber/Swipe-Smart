<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swipe Smart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .card-checkbox:checked + label { background-color: #18181b; border-color: #18181b; }
        .card-checkbox:checked + label .card-title { color: #ffffff; }
        .card-checkbox:checked + label::after { content: '‚úì'; position: absolute; top: 16px; right: 16px; color: #ffffff; font-size: 20px; }
        .reward-type-radio:checked + label { background-color: #18181b; border-color: #18181b; color: #ffffff; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .medium-btn.selected { background-color: #18181b; color: white; border-color: #18181b; }
    </style>
</head>
<body class="bg-white min-h-screen">
    <header class="border-b border-zinc-200">
        <div class="max-w-3xl mx-auto px-6 py-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-semibold text-zinc-900">Swipe Smart</h1>
                <p class="text-sm text-zinc-600">Intelligent card recommendations</p>
            </div>
            <div id="headerBtns" class="hidden flex gap-4">
                <button onclick="showHistory()" class="text-sm text-zinc-900 hover:text-zinc-700 underline">History</button>
                <button onclick="editProfile()" class="text-sm text-zinc-900 hover:text-zinc-700 underline">Edit Profile</button>
            </div>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-6 py-12">
        <!-- Welcome -->
        <div id="welcome" class="text-center py-20">
            <h2 class="text-4xl font-light text-zinc-900 mb-6">Find your best credit card</h2>
            <p class="text-xl text-zinc-600 mb-12">Track monthly limits and maximize rewards</p>
            <button onclick="startOnboarding()" class="bg-zinc-900 text-white px-8 py-4 rounded-xl hover:bg-zinc-800">Get Started</button>
        </div>

        <!-- Onboarding -->
        <div id="onboarding" class="hidden">
            <!-- Q1: Cards -->
            <div id="q1" class="hidden">
                <h2 class="text-3xl font-light mb-3">Which cards do you own?</h2>
                <p class="text-zinc-600 mb-8">Select all that apply</p>
                <div class="space-y-3 mb-8 max-h-96 overflow-y-auto">
                    <div class="relative"><input type="checkbox" id="c1" value="SBI Cashback" class="hidden card-checkbox"/><label for="c1" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">SBI Cashback</span><span class="card-subtitle text-xs block text-zinc-500">5% online</span></label></div>
                    <div class="relative"><input type="checkbox" id="c2" value="Amazon Pay ICICI" class="hidden card-checkbox"/><label for="c2" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Amazon Pay ICICI</span><span class="card-subtitle text-xs block text-zinc-500">5% Amazon</span></label></div>
                    <div class="relative"><input type="checkbox" id="c3" value="Swiggy HDFC" class="hidden card-checkbox"/><label for="c3" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Swiggy HDFC</span><span class="card-subtitle text-xs block text-zinc-500">10% Swiggy</span></label></div>
                    <div class="relative"><input type="checkbox" id="c4" value="HDFC Millennia" class="hidden card-checkbox"/><label for="c4" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">HDFC Millennia</span><span class="card-subtitle text-xs block text-zinc-500">5% partners</span></label></div>
                    <div class="relative"><input type="checkbox" id="c5" value="Axis Magnus" class="hidden card-checkbox"/><label for="c5" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Axis Magnus</span><span class="card-subtitle text-xs block text-zinc-500">Premium</span></label></div>
                    <div class="relative"><input type="checkbox" id="c6" value="Flipkart Axis" class="hidden card-checkbox"/><label for="c6" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Flipkart Axis</span><span class="card-subtitle text-xs block text-zinc-500">5% Flipkart</span></label></div>
                    <div class="relative"><input type="checkbox" id="c7" value="Scapia" class="hidden card-checkbox"/><label for="c7" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Scapia</span><span class="card-subtitle text-xs block text-zinc-500">Travel rewards</span></label></div>
                    <div class="relative"><input type="checkbox" id="c8" value="Indian Oil HDFC" class="hidden card-checkbox"/><label for="c8" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Indian Oil HDFC</span><span class="card-subtitle text-xs block text-zinc-500">Fuel 5%</span></label></div>
                    <div class="relative"><input type="checkbox" id="c9" value="BPCL Octane ICICI" class="hidden card-checkbox"/><label for="c9" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">BPCL Octane</span><span class="card-subtitle text-xs block text-zinc-500">BPCL fuel</span></label></div>
                    <div class="relative"><input type="checkbox" id="c10" value="ICICI Coral" class="hidden card-checkbox"/><label for="c10" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">ICICI Coral</span><span class="card-subtitle text-xs block text-zinc-500">Dining</span></label></div>
                    <div class="relative"><input type="checkbox" id="c11" value="AU Lit" class="hidden card-checkbox"/><label for="c11" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">AU Lit</span><span class="card-subtitle text-xs block text-zinc-500">2% food</span></label></div>
                    <div class="relative"><input type="checkbox" id="c12" value="Axis Ace" class="hidden card-checkbox"/><label for="c12" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Axis Ace</span><span class="card-subtitle text-xs block text-zinc-500">5% GPay</span></label></div>
                    <div class="relative"><input type="checkbox" id="c13" value="SBI SimplyCLICK" class="hidden card-checkbox"/><label for="c13" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">SBI SimplyCLICK</span><span class="card-subtitle text-xs block text-zinc-500">10X online</span></label></div>
                    <div class="relative"><input type="checkbox" id="c14" value="HDFC Regalia Gold" class="hidden card-checkbox"/><label for="c14" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">HDFC Regalia Gold</span><span class="card-subtitle text-xs block text-zinc-500">Travel/dining</span></label></div>
                    <div class="relative"><input type="checkbox" id="c15" value="Amex Platinum Travel" class="hidden card-checkbox"/><label for="c15" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="card-title font-semibold">Amex Platinum Travel</span><span class="card-subtitle text-xs block text-zinc-500">5X travel</span></label></div>
                </div>
                <button onclick="nextQ(1)" class="w-full bg-zinc-900 text-white py-4 rounded-xl">Continue</button>
            </div>

            <!-- Q2: Preferred -->
            <div id="q2" class="hidden">
                <h2 class="text-3xl font-light mb-3">Preferred card?</h2>
                <p class="text-zinc-600 mb-8">For tie-breaks</p>
                <select id="prefCard" class="w-full p-4 border-2 border-zinc-200 rounded-xl mb-8"></select>
                <button onclick="nextQ(2)" class="w-full bg-zinc-900 text-white py-4 rounded-xl">Continue</button>
            </div>

            <!-- Q3: Reward Type -->
            <div id="q3" class="hidden">
                <h2 class="text-3xl font-light mb-3">Preferred reward type?</h2>
                <div class="space-y-3 mb-8">
                    <div class="relative"><input type="radio" id="r1" name="reward" value="cashback" class="hidden reward-type-radio" checked/><label for="r1" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="reward-title font-semibold">Cashback</span></label></div>
                    <div class="relative"><input type="radio" id="r2" name="reward" value="points" class="hidden reward-type-radio"/><label for="r2" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="reward-title font-semibold">Reward Points</span></label></div>
                    <div class="relative"><input type="radio" id="r3" name="reward" value="airmiles" class="hidden reward-type-radio"/><label for="r3" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="reward-title font-semibold">Air Miles</span></label></div>
                    <div class="relative"><input type="radio" id="r4" name="reward" value="fuel" class="hidden reward-type-radio"/><label for="r4" class="block p-4 border-2 border-zinc-200 rounded-xl cursor-pointer"><span class="reward-title font-semibold">Fuel Points</span></label></div>
                </div>
                <button onclick="finishOnboarding()" class="w-full bg-zinc-900 text-white py-4 rounded-xl">Complete</button>
            </div>
        </div>

        <!-- Main App -->
        <div id="app" class="hidden">
            <!-- Savings -->
            <div class="bg-white border border-zinc-200 rounded-xl p-8 mb-8">
                <div class="flex justify-between">
                    <div><p class="text-sm text-zinc-500">Total Saved This Month</p><p class="text-5xl font-light" id="saved">‚Çπ0</p></div>
                    <p class="text-sm text-zinc-500"><span id="count">0</span> recommendations</p>
                </div>
            </div>

            <!-- Form -->
            <form id="form" class="bg-white border border-zinc-200 rounded-xl p-10 mb-8">
                <h2 class="text-2xl font-semibold mb-8">New Recommendation</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Merchant</label>
                        <input type="text" id="merchant" placeholder="e.g. Swiggy, Nykaa" class="w-full p-4 border-2 border-zinc-200 rounded-xl" required/>
                    </div>

                    <div id="mediumBox" class="hidden p-6 bg-zinc-50 border border-zinc-200 rounded-xl">
                        <p class="text-sm font-medium mb-4"><span id="merchName"></span> is available both online & offline. Where?</p>
                        <div class="flex gap-3">
                            <button type="button" onclick="setMedium('online')" id="btnOnline" class="flex-1 py-3 border-2 rounded-xl medium-btn">üåê Online</button>
                            <button type="button" onclick="setMedium('offline')" id="btnOffline" class="flex-1 py-3 border-2 rounded-xl medium-btn">üè™ Offline</button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Category</label>
                        <select id="category" class="w-full p-4 border-2 border-zinc-200 rounded-xl">
                            <option value="">Auto-detect</option>
                            <option value="food delivery">Food Delivery</option>
                            <option value="online shopping">Online Shopping</option>
                            <option value="groceries">Groceries</option>
                            <option value="travel">Travel</option>
                            <option value="fuel">Fuel</option>
                            <option value="dining">Dining</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="utilities">Utilities</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Amount</label>
                        <input type="number" id="amount" placeholder="‚Çπ" class="w-full p-4 border-2 border-zinc-200 rounded-xl" required/>
                    </div>
                </div>

                <input type="hidden" id="medium" value=""/>
                <button type="submit" class="w-full mt-8 bg-zinc-900 text-white py-4 rounded-xl">Get Recommendation</button>
            </form>

            <!-- Loading -->
            <div id="loading" class="hidden text-center p-10">
                <div class="loading w-12 h-12 border-4 border-zinc-900 border-t-transparent rounded-full mx-auto mb-4"></div>
                <p>Finding best card...</p>
            </div>

            <!-- Results -->
            <div id="results" class="hidden bg-white border border-zinc-200 rounded-xl p-10">
                <p class="text-sm text-zinc-500 mb-2">Recommended Card</p>
                <h3 class="text-3xl font-semibold mb-2" id="bestCard"></h3>
                <p class="text-2xl font-light text-green-700 mb-8" id="bestReward"></p>

                <div class="border-t border-zinc-200 pt-8 mb-8">
                    <p id="explanation"></p>
                </div>

                <!-- Breakdown -->
                <div id="breakdownBox" class="hidden border-t border-zinc-200 pt-8 mb-8">
                    <p class="text-sm font-medium text-zinc-500 mb-4">Savings Breakdown</p>
                    <div id="breakdownContent"></div>
                </div>

                <!-- Confidence -->
                <div class="mb-8">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm text-zinc-500">Confidence</span>
                        <span class="text-sm font-semibold" id="conf"></span>
                    </div>
                    <div class="w-full h-2 bg-zinc-200 rounded-full">
                        <div id="confBar" class="h-full bg-zinc-900" style="width:0%"></div>
                    </div>
                </div>

                <!-- Used Checkbox -->
                <div class="border-t border-zinc-200 pt-8 mb-8">
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" id="usedCheck" class="w-5 h-5" onchange="markUsed()"/>
                        <span class="text-sm font-medium">I used this recommendation</span>
                    </label>
                </div>

                <!-- Alternatives -->
                <div id="altsBox" class="hidden border-t border-zinc-200 pt-8 mb-8">
                    <p class="text-sm font-medium text-zinc-500 mb-4">Alternatives</p>
                    <div id="altsList"></div>
                </div>

                <button onclick="newRec()" class="w-full bg-zinc-900 text-white py-4 rounded-xl">New Recommendation</button>
            </div>
        </div>

        <!-- History Modal -->
        <div id="histModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                <div class="p-6 border-b flex justify-between">
                    <div><h2 class="text-2xl font-semibold">History</h2></div>
                    <button onclick="closeHistory()" class="text-2xl">&times;</button>
                </div>
                <div class="flex-1 overflow-y-auto p-6" id="histList"></div>
            </div>
        </div>
    </main>

    <script>
        const URL = 'https://steep-snow-ab31swipe-smart-proxy.rashi-anand3798.workers.dev';
        let profile = null;
        let savings = {total: 0, count: 0};
        let medium = null;
        let currentRec = null;

        const BOTH = ['zomato','nykaa','lenskart','jiomart','dominos','pizza hut','mcdonalds',"mcdonald's",'burger king','kfc','croma','cultfit','cult.fit','caratlane','bluestone'];

        function scrollTop() { window.scrollTo({top:0, behavior:'smooth'}); }
        
        function save(k,v) { localStorage.setItem('ss_'+k, JSON.stringify(v)); }
        function load(k) { const s = localStorage.getItem('ss_'+k); return s ? JSON.parse(s) : null; }
        
        function loadSavings() {
            const s = load('savings');
            if (!s) return {total:0,count:0,month:new Date().getMonth(),year:new Date().getFullYear()};
            const now = new Date();
            if (s.month !== now.getMonth() || s.year !== now.getFullYear()) {
                return {total:0,count:0,month:now.getMonth(),year:now.getFullYear()};
            }
            return s;
        }

        function loadUsage() {
            const u = load('usage');
            if (!u) return {month:new Date().getMonth(),year:new Date().getFullYear(),cards:{}};
            const now = new Date();
            if (u.month !== now.getMonth() || u.year !== now.getFullYear()) {
                return {month:now.getMonth(),year:now.getFullYear(),cards:{}};
            }
            return u;
        }

        function updateSavings() {
            document.getElementById('saved').textContent = '‚Çπ' + Math.round(savings.total);
            document.getElementById('count').textContent = savings.count;
        }

        function startOnboarding() {
            scrollTop();
            document.getElementById('welcome').classList.add('hidden');
            document.getElementById('onboarding').classList.remove('hidden');
            document.getElementById('q1').classList.remove('hidden');
        }

        function nextQ(n) {
            if (n === 1) {
                const cards = [];
                for (let i=1; i<=15; i++) {
                    const cb = document.getElementById('c'+i);
                    if (cb.checked) cards.push(cb.value);
                }
                if (cards.length === 0) return alert('Select at least 1 card');
                
                const sel = document.getElementById('prefCard');
                sel.innerHTML = cards.map(c => `<option value="${c}">${c}</option>`).join('');
                profile = {cards};
            }
            
            document.getElementById('q'+n).classList.add('hidden');
            document.getElementById('q'+(n+1)).classList.remove('hidden');
            scrollTop();
        }

        function finishOnboarding() {
            profile.pref = document.getElementById('prefCard').value;
            profile.reward = document.querySelector('input[name="reward"]:checked').value;
            save('profile', profile);
            
            savings = loadSavings();
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('headerBtns').classList.remove('hidden');
            updateSavings();
            scrollTop();
        }

        function editProfile() {
            scrollTop();
            document.getElementById('app').classList.add('hidden');
            document.getElementById('onboarding').classList.remove('hidden');
            document.getElementById('q1').classList.remove('hidden');
            document.getElementById('q2').classList.add('hidden');
            document.getElementById('q3').classList.add('hidden');
        }

        document.getElementById('merchant').addEventListener('blur', function() {
            const m = this.value.trim().toLowerCase();
            if (BOTH.includes(m)) {
                document.getElementById('merchName').textContent = this.value;
                document.getElementById('mediumBox').classList.remove('hidden');
            } else {
                document.getElementById('mediumBox').classList.add('hidden');
                medium = null;
            }
        });

        function setMedium(m) {
            medium = m;
            document.getElementById('medium').value = m;
            document.querySelectorAll('.medium-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('btn' + (m==='online'?'Online':'Offline')).classList.add('selected');
        }

        document.getElementById('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const merchant = document.getElementById('merchant').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value;
            
            document.getElementById('form').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                const usage = loadUsage();
                const res = await fetch(URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        merchant,
                        amount,
                        category,
                        medium: medium || '',
                        cardsOwned: profile.cards,
                        userPreferences: {preferredCard: profile.pref, rewardType: profile.reward},
                        usageData: usage.cards || {}
                    })
                });
                
                if (!res.ok) throw new Error('HTTP ' + res.status);
                
                let data = await res.json();
                if (Array.isArray(data)) data = data[0];
                if (data.json) data = data.json;
                
                currentRec = {merchant, amount, ...data};
                showResults(data);
                
            } catch(err) {
                console.error(err);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('form').classList.remove('hidden');
                alert('Error: ' + err.message);
            }
        });

        function showResults(r) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            const card = r.bestCard || 'Unknown';
            const reward = parseFloat(r.bestReward || 0);
            const exp = r.explanation || r.reason || '';
            const conf = parseFloat(r.confidence || 0.9);
            const bd = r.breakdown || {base:reward, accelerated:0, milestone:0};
            
            document.getElementById('bestCard').textContent = card;
            document.getElementById('bestReward').textContent = 'Save ‚Çπ' + reward.toFixed(2);
            document.getElementById('explanation').textContent = exp;
            document.getElementById('conf').textContent = Math.round(conf*100) + '%';
            document.getElementById('confBar').style.width = (conf*100) + '%';
            document.getElementById('usedCheck').checked = false;
            
            // Breakdown
            if (bd.base > 0 || bd.accelerated > 0 || bd.milestone > 0) {
                let html = '';
                if (bd.base > 0) html += `<div class="flex justify-between mb-2"><span class="text-sm">Base</span><span class="font-semibold">‚Çπ${bd.base.toFixed(2)}</span></div>`;
                if (bd.accelerated > 0) html += `<div class="flex justify-between mb-2"><span class="text-sm">Accelerated</span><span class="font-semibold text-green-700">‚Çπ${bd.accelerated.toFixed(2)}</span></div>`;
                if (bd.milestone > 0) html += `<div class="flex justify-between mb-2"><span class="text-sm">Milestone</span><span class="font-semibold text-amber-600">‚Çπ${bd.milestone.toFixed(2)}</span></div>`;
                document.getElementById('breakdownContent').innerHTML = html;
                document.getElementById('breakdownBox').classList.remove('hidden');
            } else {
                document.getElementById('breakdownBox').classList.add('hidden');
            }
            
            // Alts
            const alts = r.alternatives;
            if (alts && alts.length > 0) {
                document.getElementById('altsList').innerHTML = alts.map(a => 
                    `<div class="flex justify-between p-4 bg-zinc-50 border rounded-xl mb-2">
                        <div><p class="text-sm font-semibold">${a.card}</p><p class="text-xs text-zinc-600">${a.reason||''}</p></div>
                        <span class="font-semibold">‚Çπ${(a.rewardValue||0).toFixed(2)}</span>
                    </div>`
                ).join('');
                document.getElementById('altsBox').classList.remove('hidden');
            } else {
                document.getElementById('altsBox').classList.add('hidden');
            }
            
            // Save history
            const hist = load('history') || [];
            hist.unshift({
                id: Date.now(),
                time: new Date().toISOString(),
                merchant: currentRec.merchant,
                amount: currentRec.amount,
                card,
                reward,
                breakdown: bd,
                exp
            });
            if (hist.length > 50) hist.pop();
            save('history', hist);
            
            scrollTop();
        }

        function markUsed() {
            if (document.getElementById('usedCheck').checked) {
                const usage = loadUsage();
                const card = currentRec.bestCard;
                const amt = parseFloat(currentRec.bestReward);
                
                if (!usage.cards[card]) usage.cards[card] = {};
                usage.cards[card]['tracked'] = (usage.cards[card]['tracked'] || 0) + amt;
                save('usage', usage);
                
                savings.total += amt;
                savings.count += 1;
                save('savings', savings);
                updateSavings();
                
                const toast = document.createElement('div');
                toast.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg z-50';
                toast.textContent = '‚úì Tracked!';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            }
        }

        function newRec() {
            scrollTop();
            document.getElementById('results').classList.add('hidden');
            document.getElementById('form').classList.remove('hidden');
            document.getElementById('form').reset();
            medium = null;
        }

        function showHistory() {
            scrollTop();
            const hist = load('history') || [];
            if (hist.length === 0) {
                document.getElementById('histList').innerHTML = '<p class="text-center text-zinc-500">No history</p>';
            } else {
                document.getElementById('histList').innerHTML = hist.map(h => {
                    const d = new Date(h.time).toLocaleDateString('en-IN', {month:'short', day:'numeric'});
                    return `
                        <div class="border rounded-xl p-4 mb-3 cursor-pointer" onclick="toggleDetail(${h.id})">
                            <div class="flex justify-between">
                                <div><p class="font-semibold">${h.merchant}</p><p class="text-xs text-zinc-500">${d} ‚Ä¢ ‚Çπ${h.amount}</p></div>
                                <p class="font-semibold text-green-700">‚Çπ${h.reward.toFixed(2)}</p>
                            </div>
                            <div id="det${h.id}" class="hidden mt-4 pt-4 border-t">
                                <p class="text-xs font-semibold mb-2">Breakdown</p>
                                ${h.breakdown.base>0 ? `<div class="flex justify-between text-xs mb-1"><span>Base</span><span>‚Çπ${h.breakdown.base.toFixed(2)}</span></div>` : ''}
                                ${h.breakdown.accelerated>0 ? `<div class="flex justify-between text-xs mb-1"><span>Accelerated</span><span class="text-green-700">‚Çπ${h.breakdown.accelerated.toFixed(2)}</span></div>` : ''}
                                ${h.breakdown.milestone>0 ? `<div class="flex justify-between text-xs mb-1"><span>Milestone</span><span class="text-amber-600">‚Çπ${h.breakdown.milestone.toFixed(2)}</span></div>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            document.getElementById('histModal').classList.remove('hidden');
        }

        function closeHistory() {
            scrollTop();
            document.getElementById('histModal').classList.add('hidden');
        }

        function toggleDetail(id) {
            const el = document.getElementById('det'+id);
            el.classList.toggle('hidden');
        }

        // Init
        window.addEventListener('load', () => {
            profile = load('profile');
            if (profile) {
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                document.getElementById('headerBtns').classList.remove('hidden');
                savings = loadSavings();
                updateSavings();
            }
        });
    </script>
</body>
</html>
